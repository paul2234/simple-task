<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #fafafa;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    
    h1 {
      color: #1a1a1a;
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 600;
    }
    
    .new-task-btn {
      margin-bottom: 32px;
      align-self: flex-start;
    }

    .add-task-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 32px;
      padding-bottom: 32px;
      border-bottom: 1px solid #e5e5e5;
    }

    .add-task-form.hidden {
      display: none;
    }
    
    input {
      padding: 14px 16px;
      border: 1px solid #d4d4d4;
      border-radius: 8px;
      font-size: 15px;
      background: #fafafa;
      transition: all 0.2s;
    }
    
    input:focus {
      outline: none;
      border-color: #737373;
      background: white;
    }
    
    button {
      padding: 14px 20px;
      background: #262626;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    button:hover {
      background: #171717;
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .task-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px;
      background: #fafafa;
      border-radius: 10px;
      border: 1px solid #e5e5e5;
      transition: all 0.2s;
    }
    
    .task-item:hover {
      background: #f5f5f5;
      border-color: #d4d4d4;
    }
    
    .task-info {
      flex: 1;
    }
    
    .task-name {
      font-weight: 600;
      color: #171717;
      margin-bottom: 8px;
      font-size: 15px;
    }
    
    .task-progress {
      font-size: 13px;
      color: #737373;
      font-weight: 500;
    }
    
    .progress-bar {
      height: 4px;
      background: #e5e5e5;
      border-radius: 2px;
      margin-top: 10px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: #525252;
      transition: width 0.3s;
    }
    
    .streak-info {
      margin-top: 8px;
      font-size: 13px;
      color: #737373;
      font-weight: 500;
    }
    
    .streak-number {
      color: #f59e0b;
      font-weight: 600;
    }
    
    .task-actions {
      display: flex;
      gap: 8px;
    }
    
    .increment-btn {
      background: #10b981;
      padding: 10px 24px;
      font-weight: 600;
      font-size: 16px;
    }
    
    .increment-btn:hover {
      background: #059669;
    }
    
    .delete-btn {
      background: #525252;
      padding: 10px 16px;
      font-size: 18px;
      line-height: 1;
    }
    
    .delete-btn:hover {
      background: #262626;
    }
    
    .complete {
      background: #f5f5f5;
      border-color: #a3a3a3;
    }
    
    .complete .progress-fill {
      background: #171717;
    }
    
    .empty-state {
      text-align: center;
      color: #a3a3a3;
      padding: 40px;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import { html, render, Component } from 'https://cdn.skypack.dev/htm/preact/standalone';

    class TaskTracker extends Component {
      constructor(props) {
        super(props);
        this.state = {
          tasks: <%- JSON.stringify(tasks) %>,
          taskName: '',
          taskTarget: '',
          showForm: false
        };
      }

      handleInputChange = (field, value) => {
        this.setState({ [field]: value });
      }
      toggleForm = () => {
        this.setState({ showForm: !this.state.showForm });
      }

      addTask = async (e) => {
        e.preventDefault();
        const { taskName, taskTarget } = this.state;
        
        if (!taskName || !taskTarget) return;

        const response = await fetch('/api/tasks', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: taskName, target: taskTarget })
        });

        const newTask = await response.json();
        this.setState({
          tasks: [...this.state.tasks, newTask],
          taskName: '',
          taskTarget: '',
          showForm: false
        });
      }

      incrementTask = async (taskId) => {
        const response = await fetch(`/api/tasks/${encodeURIComponent(taskId)}/increment`, {
          method: 'POST'
        });

        const updatedTask = await response.json();
        this.setState({
          tasks: this.state.tasks.map(t => t.id === taskId ? updatedTask : t)
        });
      }

      deleteTask = async (taskId) => {
        await fetch(`/api/tasks/${encodeURIComponent(taskId)}`, {
          method: 'DELETE'
        });

        this.setState({
          tasks: this.state.tasks.filter(t => t.id !== taskId)
        });
      }

      render() {
        const { tasks, taskName, taskTarget, showForm } = this.state;

        return html`
          <div class="container">
            <h1>ðŸ“‹ Daily Task Tracker</h1>
            
            ${!showForm && html`
              <button class="new-task-btn" onClick=${this.toggleForm}>
                + New Task
              </button>
            `}

            <form class="add-task-form ${showForm ? '' : 'hidden'}" onSubmit=${this.addTask}>
              <input
                type="text"
                placeholder="Task name (e.g., Email potential leads)"
                value=${taskName}
                onInput=${(e) => this.handleInputChange('taskName', e.target.value)}
              />
              <input
                type="number"
                placeholder="Daily target (e.g., 100)"
                value=${taskTarget}
                onInput=${(e) => this.handleInputChange('taskTarget', e.target.value)}
              />
              <div style="display: flex; gap: 8px;">
                <button type="submit" style="flex: 1;">Add Task</button>
                <button type="button" onClick=${this.toggleForm} style="background: #737373; flex: 1;">
                  Cancel
                </button>
              </div>
            </form>

            <div class="task-list">
              ${tasks.length === 0 ? html`
                <div class="empty-state">
                  No tasks yet. Add your first task above!
                </div>
              ` : tasks.map(task => {
                const progress = Math.min((task.current / task.target) * 100, 100);
                const isComplete = task.current >= task.target;
                
                return html`
                  <div class="task-item ${isComplete ? 'complete' : ''}">
                    <div class="task-info">
                      <div class="task-name">${task.name}</div>
                      <div class="task-progress">
                        ${task.current} / ${task.target} 
                        ${isComplete ? 'âœ…' : `(${Math.round(progress)}%)`}
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                      </div>
                      ${task.streak > 0 && html`
                        <div class="streak-info">
                          ðŸ”¥ <span class="streak-number">${task.streak}</span> day${task.streak !== 1 ? 's' : ''} streak
                        </div>
                      `}
                    </div>
                    <div class="task-actions">
                      <button 
                        class="increment-btn"
                        onClick=${() => this.incrementTask(task.id)}
                      >
                        +1
                      </button>
                      <button 
                        class="delete-btn"
                        onClick=${() => this.deleteTask(task.id)}
                      >
                        Ã—
                      </button>
                    </div>
                  </div>
                `;
              })}
            </div>
          </div>
        `;
      }
    }

    render(html`<${TaskTracker} />`, document.getElementById('app'));
  </script>
</body>
</html>
